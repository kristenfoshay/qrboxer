Attaching to qrboxer-backend_db_1, qrboxer-backend_test-db_1, qrboxer-backend_tests_1
[33mtest-db_1  |[0m The files belonging to this database system will be owned by user "postgres".
[33mtest-db_1  |[0m This user must also own the server process.
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m The database cluster will be initialized with locale "en_US.utf8".
[33mtest-db_1  |[0m The default database encoding has accordingly been set to "UTF8".
[33mtest-db_1  |[0m The default text search configuration will be set to "english".
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m Data page checksums are disabled.
[36mdb_1       |[0m The files belonging to this database system will be owned by user "postgres".
[36mdb_1       |[0m This user must also own the server process.
[36mdb_1       |[0m 
[33mtest-db_1  |[0m 
[36mdb_1       |[0m The database cluster will be initialized with locale "en_US.utf8".
[36mdb_1       |[0m The default database encoding has accordingly been set to "UTF8".
[36mdb_1       |[0m The default text search configuration will be set to "english".
[36mdb_1       |[0m 
[36mdb_1       |[0m Data page checksums are disabled.
[33mtest-db_1  |[0m fixing permissions on existing directory /var/lib/postgresql/data ... ok
[36mdb_1       |[0m 
[36mdb_1       |[0m fixing permissions on existing directory /var/lib/postgresql/data ... ok
[33mtest-db_1  |[0m creating subdirectories ... ok
[36mdb_1       |[0m creating subdirectories ... ok
[33mtest-db_1  |[0m selecting dynamic shared memory implementation ... posix
[36mdb_1       |[0m selecting dynamic shared memory implementation ... posix
[33mtest-db_1  |[0m selecting default max_connections ... 100
[36mdb_1       |[0m selecting default max_connections ... 100
[33mtest-db_1  |[0m selecting default shared_buffers ... 128MB
[36mdb_1       |[0m selecting default shared_buffers ... 128MB
[36mdb_1       |[0m selecting default time zone ... Etc/UTC
[33mtest-db_1  |[0m selecting default time zone ... Etc/UTC
[36mdb_1       |[0m creating configuration files ... ok
[33mtest-db_1  |[0m creating configuration files ... ok
[36mdb_1       |[0m running bootstrap script ... ok
[33mtest-db_1  |[0m running bootstrap script ... ok
[36mdb_1       |[0m performing post-bootstrap initialization ... ok
[33mtest-db_1  |[0m performing post-bootstrap initialization ... ok
[36mdb_1       |[0m syncing data to disk ... initdb: warning: enabling "trust" authentication for local connections
[36mdb_1       |[0m You can change this by editing pg_hba.conf or using the option -A, or
[36mdb_1       |[0m --auth-local and --auth-host, the next time you run initdb.
[33mtest-db_1  |[0m syncing data to disk ... ok
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m Success. You can now start the database server using:
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m     pg_ctl -D /var/lib/postgresql/data -l logfile start
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m initdb: warning: enabling "trust" authentication for local connections
[33mtest-db_1  |[0m You can change this by editing pg_hba.conf or using the option -A, or
[33mtest-db_1  |[0m --auth-local and --auth-host, the next time you run initdb.
[36mdb_1       |[0m ok
[36mdb_1       |[0m 
[36mdb_1       |[0m 
[36mdb_1       |[0m Success. You can now start the database server using:
[36mdb_1       |[0m 
[36mdb_1       |[0m     pg_ctl -D /var/lib/postgresql/data -l logfile start
[36mdb_1       |[0m 
[33mtest-db_1  |[0m waiting for server to start....2025-02-15 17:54:53.563 UTC [48] LOG:  starting PostgreSQL 14.15 (Debian 14.15-1.pgdg120+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit
[33mtest-db_1  |[0m 2025-02-15 17:54:53.648 UTC [48] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
[36mdb_1       |[0m waiting for server to start....2025-02-15 17:54:53.611 UTC [48] LOG:  starting PostgreSQL 14.15 (Debian 14.15-1.pgdg120+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit
[33mtest-db_1  |[0m 2025-02-15 17:54:53.932 UTC [49] LOG:  database system was shut down at 2025-02-15 17:54:51 UTC
[36mdb_1       |[0m 2025-02-15 17:54:53.696 UTC [48] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
[33mtest-db_1  |[0m 2025-02-15 17:54:54.034 UTC [48] LOG:  database system is ready to accept connections
[36mdb_1       |[0m 2025-02-15 17:54:53.974 UTC [49] LOG:  database system was shut down at 2025-02-15 17:54:51 UTC
[36mdb_1       |[0m 2025-02-15 17:54:54.087 UTC [48] LOG:  database system is ready to accept connections
[33mtest-db_1  |[0m  done
[33mtest-db_1  |[0m server started
[33mtest-db_1  |[0m CREATE DATABASE
[36mdb_1       |[0m  done
[36mdb_1       |[0m server started
[33mtest-db_1  |[0m 
[36mdb_1       |[0m CREATE DATABASE
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m /usr/local/bin/docker-entrypoint.sh: running /docker-entrypoint-initdb.d/schema.sql
[36mdb_1       |[0m 
[33mtest-db_1  |[0m CREATE TABLE
[36mdb_1       |[0m 
[36mdb_1       |[0m /usr/local/bin/docker-entrypoint.sh: ignoring /docker-entrypoint-initdb.d/*
[36mdb_1       |[0m 
[33mtest-db_1  |[0m CREATE TABLE
[36mdb_1       |[0m 2025-02-15 17:54:56.050 UTC [48] LOG:  received fast shutdown request
[33mtest-db_1  |[0m CREATE TABLE
[33mtest-db_1  |[0m CREATE TABLE
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m 
[36mdb_1       |[0m waiting for server to shut down....2025-02-15 17:54:56.130 UTC [48] LOG:  aborting any active transactions
[33mtest-db_1  |[0m 2025-02-15 17:54:57.607 UTC [48] LOG:  received fast shutdown request
[33mtest-db_1  |[0m waiting for server to shut down....2025-02-15 17:54:57.929 UTC [48] LOG:  aborting any active transactions
[33mtest-db_1  |[0m 2025-02-15 17:54:57.932 UTC [48] LOG:  background worker "logical replication launcher" (PID 55) exited with exit code 1
[36mdb_1       |[0m 2025-02-15 17:54:56.133 UTC [48] LOG:  background worker "logical replication launcher" (PID 55) exited with exit code 1
[33mtest-db_1  |[0m 2025-02-15 17:54:57.933 UTC [50] LOG:  shutting down
[36mdb_1       |[0m 2025-02-15 17:54:56.133 UTC [50] LOG:  shutting down
[36mdb_1       |[0m 2025-02-15 17:54:56.174 UTC [69] FATAL:  the database system is shutting down
[33mtest-db_1  |[0m ..2025-02-15 17:54:59.991 UTC [48] LOG:  database system is shut down
[36mdb_1       |[0m .2025-02-15 17:54:57.621 UTC [48] LOG:  database system is shut down
[33mtest-db_1  |[0m  done
[33mtest-db_1  |[0m server stopped
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m PostgreSQL init process complete; ready for start up.
[33mtest-db_1  |[0m 
[33mtest-db_1  |[0m 2025-02-15 17:55:00.249 UTC [1] LOG:  starting PostgreSQL 14.15 (Debian 14.15-1.pgdg120+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit
[33mtest-db_1  |[0m 2025-02-15 17:55:00.249 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
[33mtest-db_1  |[0m 2025-02-15 17:55:00.250 UTC [1] LOG:  listening on IPv6 address "::", port 5432
[36mdb_1       |[0m  done
[36mdb_1       |[0m server stopped
[36mdb_1       |[0m 
[36mdb_1       |[0m PostgreSQL init process complete; ready for start up.
[36mdb_1       |[0m 
[33mtest-db_1  |[0m 2025-02-15 17:55:00.427 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
[36mdb_1       |[0m 2025-02-15 17:54:58.182 UTC [1] LOG:  starting PostgreSQL 14.15 (Debian 14.15-1.pgdg120+1) on x86_64-pc-linux-gnu, compiled by gcc (Debian 12.2.0-14) 12.2.0, 64-bit
[33mtest-db_1  |[0m 2025-02-15 17:55:00.832 UTC [73] LOG:  database system was shut down at 2025-02-15 17:54:59 UTC
[36mdb_1       |[0m 2025-02-15 17:54:58.182 UTC [1] LOG:  listening on IPv4 address "0.0.0.0", port 5432
[36mdb_1       |[0m 2025-02-15 17:54:58.182 UTC [1] LOG:  listening on IPv6 address "::", port 5432
[33mtest-db_1  |[0m 2025-02-15 17:55:00.938 UTC [1] LOG:  database system is ready to accept connections
[36mdb_1       |[0m 2025-02-15 17:54:58.541 UTC [1] LOG:  listening on Unix socket "/var/run/postgresql/.s.PGSQL.5432"
[36mdb_1       |[0m 2025-02-15 17:54:59.191 UTC [71] LOG:  database system was shut down at 2025-02-15 17:54:57 UTC
[36mdb_1       |[0m 2025-02-15 17:54:59.283 UTC [1] LOG:  database system is ready to accept connections
[32mtests_1    |[0m 
[32mtests_1    |[0m > qrboxer@0.1.0 test
[32mtests_1    |[0m > jest -i --detectOpenHandles --forceExit --verbose --forceExit --detectOpenHandles --runInBand
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/models/move.test.js
[32mtests_1    |[0m   Move Model Tests
[32mtests_1    |[0m     create
[32mtests_1    |[0m       âœ• works (2 ms)
[32mtests_1    |[0m       âœ• bad request with duplicate date (1 ms)
[32mtests_1    |[0m     get
[32mtests_1    |[0m       âœ• works
[32mtests_1    |[0m       âœ• not found if no such move (1 ms)
[32mtests_1    |[0m     update
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• not found if no such move (1 ms)
[32mtests_1    |[0m       âœ• works: partial update (1 ms)
[32mtests_1    |[0m     findAll
[32mtests_1    |[0m       âœ• works: finds all moves for user (1 ms)
[32mtests_1    |[0m       âœ• works: returns empty array if no moves found (1 ms)
[32mtests_1    |[0m     remove
[32mtests_1    |[0m       âœ• works: removes move and boxes cascade (1 ms)
[32mtests_1    |[0m       âœ• not found if no such move (1 ms)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º create â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º create â€º bad request with duplicate date
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º get â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º get â€º not found if no such move
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º update â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º update â€º not found if no such move
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º update â€º works: partial update
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º findAll â€º works: finds all moves for user
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º findAll â€º works: returns empty array if no moves found
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º remove â€º works: removes move and boxes cascade
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Move Model Tests â€º remove â€º not found if no such move
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        9 | describe("Move Model Tests", () => {
[32mtests_1    |[0m       10 |   beforeEach(async () => {
[32mtests_1    |[0m     > 11 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/move.test.js:11:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m POST /users 201 75 - 3.601 ms
[32mtests_1    |[0m POST /users 400 202 - 1.249 ms
[32mtests_1    |[0m POST /users 400 233 - 1.101 ms
[32mtests_1    |[0m GET /users 200 103 - 0.741 ms
[32mtests_1    |[0m GET /users 200 12 - 0.519 ms
[32mtests_1    |[0m GET /users/testuser 200 144 - 0.533 ms
[32mtests_1    |[0m GET /users/nonexistent 404 26 - 0.412 ms
[32mtests_1    |[0m PATCH /users/testuser 200 55 - 0.907 ms
[32mtests_1    |[0m PATCH /users/testuser 400 32 - 0.328 ms
[32mtests_1    |[0m PATCH /users/testuser 400 35 - 0.315 ms
[32mtests_1    |[0m PATCH /users/nonexistent 404 26 - 0.605 ms
[32mtests_1    |[0m DELETE /users/testuser 200 22 - 0.411 ms
[32mtests_1    |[0m DELETE /users/nonexistent 404 26 - 0.440 ms
[32mtests_1    |[0m PASS tests/routes/userRoutes.test.js
[32mtests_1    |[0m   User Routes Test
[32mtests_1    |[0m     POST /users
[32mtests_1    |[0m       âœ“ works: creates a new user (43 ms)
[32mtests_1    |[0m       âœ“ bad request with missing fields (12 ms)
[32mtests_1    |[0m       âœ“ bad request with invalid data (14 ms)
[32mtests_1    |[0m     GET /users
[32mtests_1    |[0m       âœ“ works: gets all users (9 ms)
[32mtests_1    |[0m       âœ“ works: empty list on no users (16 ms)
[32mtests_1    |[0m     GET /users/:username
[32mtests_1    |[0m       âœ“ works: gets user by username (10 ms)
[32mtests_1    |[0m       âœ“ not found if user doesn't exist (10 ms)
[32mtests_1    |[0m     PATCH /users/:username
[32mtests_1    |[0m       âœ“ works: updates user (8 ms)
[32mtests_1    |[0m       âœ“ bad request with invalid data (12 ms)
[32mtests_1    |[0m       âœ“ bad request with empty update (11 ms)
[32mtests_1    |[0m       âœ“ not found if user doesn't exist (8 ms)
[32mtests_1    |[0m     DELETE /users/:username
[32mtests_1    |[0m       âœ“ works: deletes user (8 ms)
[32mtests_1    |[0m       âœ“ not found if user doesn't exist (8 ms)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/models/box.test.js
[32mtests_1    |[0m   Box Model Tests
[32mtests_1    |[0m     create
[32mtests_1    |[0m       âœ• works (2 ms)
[32mtests_1    |[0m     findAll
[32mtests_1    |[0m       âœ• works: no filter (1 ms)
[32mtests_1    |[0m     findAllbyUser
[32mtests_1    |[0m       âœ• works with move filter (1 ms)
[32mtests_1    |[0m       âœ• returns empty array if no boxes found (1 ms)
[32mtests_1    |[0m     get
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• not found if no such box (1 ms)
[32mtests_1    |[0m     getMoveBoxes
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• returns empty array if no boxes found (1 ms)
[32mtests_1    |[0m     update
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• not found if no such box (1 ms)
[32mtests_1    |[0m     remove
[32mtests_1    |[0m       âœ• works
[32mtests_1    |[0m       âœ• not found if no such box
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º create â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º findAll â€º works: no filter
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º findAllbyUser â€º works with move filter
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º findAllbyUser â€º returns empty array if no boxes found
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º get â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º get â€º not found if no such box
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º getMoveBoxes â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º getMoveBoxes â€º returns empty array if no boxes found
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º update â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º update â€º not found if no such box
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º remove â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Model Tests â€º remove â€º not found if no such box
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 |
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/box.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/routes/boxRoutes.test.js
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Automated CRUD Testing â€º CREATE: should create multiple boxes
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Automated CRUD Testing â€º READ: should retrieve all created boxes
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Automated CRUD Testing â€º UPDATE: should update each box
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Automated CRUD Testing â€º DELETE: should delete all created boxes
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Error Handling Tests â€º should handle invalid box creation
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Error Handling Tests â€º should handle non-existent box operations
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Box Routes Automated Tests â€º Query Parameter Tests â€º should filter boxes by location
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   
[32mtests_1    |[0m        9 |   beforeAll(async () => {
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Test suite failed to run
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       29 |
[32mtests_1    |[0m       30 |   afterAll(async () => {
[32mtests_1    |[0m     > 31 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       32 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       33 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       34 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/boxRoutes.test.js:31:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     POST /items hit with body: { description: 'Kitchen appliance', box: 1, image: 'test.jpg' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:14:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m POST /items 201 78 - 4.652 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     POST /items hit with body: { description: 'Missing box field' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:14:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     POST /items error: BadRequestError: instance requires property "box"
[32mtests_1    |[0m         at /usr/src/app/routes/items.js:19:13
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m         at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at Function.handle (/usr/src/app/node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m         at router (/usr/src/app/node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at next (/usr/src/app/middleware/auth.js:15:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at logger (/usr/src/app/node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at /usr/src/app/node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m         at AsyncResource.runInAsyncScope (node:async_hooks:203:9)
[32mtests_1    |[0m         at invokeCallback (/usr/src/app/node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m         at done (/usr/src/app/node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m         at IncomingMessage.onEnd (/usr/src/app/node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m         at IncomingMessage.emit (node:events:525:35)
[32mtests_1    |[0m         at endReadableNT (node:internal/streams/readable:1358:12)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:83:21) {
[32mtests_1    |[0m       status: 400
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       23 |     return res.status(201).json({ item });
[32mtests_1    |[0m       24 |   } catch (err) {
[32mtests_1    |[0m     > 25 |     console.error("POST /items error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       26 |     return next(err);
[32mtests_1    |[0m       27 |   }
[32mtests_1    |[0m       28 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:25:13)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m       at Route.dispatch (node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at Function.handle (node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m       at router (node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at next (middleware/auth.js:15:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at logger (node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m       at invokeCallback (node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m       at done (node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m       at IncomingMessage.onEnd (node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m 
[32mtests_1    |[0m POST /items 400 73 - 26.318 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     POST /items hit with body: { description: 'Test description', box: 'not-a-number' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:14:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     POST /items error: BadRequestError: instance.box is not of a type(s) integer
[32mtests_1    |[0m         at /usr/src/app/routes/items.js:19:13
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m         at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at Function.handle (/usr/src/app/node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m         at router (/usr/src/app/node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at next (/usr/src/app/middleware/auth.js:15:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at logger (/usr/src/app/node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at /usr/src/app/node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m         at AsyncResource.runInAsyncScope (node:async_hooks:203:9)
[32mtests_1    |[0m         at invokeCallback (/usr/src/app/node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m         at done (/usr/src/app/node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m         at IncomingMessage.onEnd (/usr/src/app/node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m         at IncomingMessage.emit (node:events:525:35)
[32mtests_1    |[0m         at endReadableNT (node:internal/streams/readable:1358:12)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:83:21) {
[32mtests_1    |[0m       status: 400
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       23 |     return res.status(201).json({ item });
[32mtests_1    |[0m       24 |   } catch (err) {
[32mtests_1    |[0m     > 25 |     console.error("POST /items error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       26 |     return next(err);
[32mtests_1    |[0m       27 |   }
[32mtests_1    |[0m       28 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:25:13)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m       at Route.dispatch (node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at Function.handle (node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m       at router (node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at next (middleware/auth.js:15:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at logger (node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m       at invokeCallback (node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m       at done (node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m       at IncomingMessage.onEnd (node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m 
[32mtests_1    |[0m POST /items 400 79 - 11.230 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     GET /items hit with query: {}
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:31:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m GET /items 200 149 - 2.814 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     GET /items hit with query: { box: '1' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:31:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m GET /items?box=1 200 82 - 2.680 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     GET /items/:id hit with id: 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:42:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m GET /items/1 200 78 - 2.722 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     GET /items/:id hit with id: 0
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:42:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     GET /items/:id error: NotFoundError: No item: 0
[32mtests_1    |[0m         at Object.<anonymous> (/usr/src/app/tests/routes/itemRoutes.test.js:140:34)
[32mtests_1    |[0m         at Promise.then.completed (/usr/src/app/node_modules/jest-circus/build/utils.js:298:28)
[32mtests_1    |[0m         at new Promise (<anonymous>)
[32mtests_1    |[0m         at callAsyncCircusFn (/usr/src/app/node_modules/jest-circus/build/utils.js:231:10)
[32mtests_1    |[0m         at _callCircusTest (/usr/src/app/node_modules/jest-circus/build/run.js:316:40)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:96:5)
[32mtests_1    |[0m         at _runTest (/usr/src/app/node_modules/jest-circus/build/run.js:252:3)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:126:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at run (/usr/src/app/node_modules/jest-circus/build/run.js:71:3)
[32mtests_1    |[0m         at runAndTransformResultsToJestFormat (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
[32mtests_1    |[0m         at jestAdapter (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
[32mtests_1    |[0m         at runTestInternal (/usr/src/app/node_modules/jest-runner/build/runTest.js:367:16)
[32mtests_1    |[0m         at runTest (/usr/src/app/node_modules/jest-runner/build/runTest.js:444:34) {
[32mtests_1    |[0m       status: 404
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       45 |     return res.json({ item });
[32mtests_1    |[0m       46 |   } catch (err) {
[32mtests_1    |[0m     > 47 |     console.error("GET /items/:id error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       48 |     return next(err);
[32mtests_1    |[0m       49 |   }
[32mtests_1    |[0m       50 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:47:13)
[32mtests_1    |[0m 
[32mtests_1    |[0m GET /items/0 404 47 - 8.451 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PATCH /items/:id hit with id: 1 body: {
[32mtests_1    |[0m       description: 'Updated Kitchen appliance',
[32mtests_1    |[0m       box: 2,
[32mtests_1    |[0m       image: 'updated.jpg'
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:53:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m PATCH /items/1 200 89 - 3.409 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PATCH /items/:id hit with id: 1 body: { box: 'not-a-number' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:53:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     PATCH /items/:id error: BadRequestError: instance.box is not of a type(s) integer
[32mtests_1    |[0m         at /usr/src/app/routes/items.js:58:13
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m         at Route.dispatch (/usr/src/app/node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m         at param (/usr/src/app/node_modules/express/lib/router/index.js:365:14)
[32mtests_1    |[0m         at param (/usr/src/app/node_modules/express/lib/router/index.js:376:14)
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:421:3)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at Function.handle (/usr/src/app/node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m         at router (/usr/src/app/node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at next (/usr/src/app/middleware/auth.js:15:12)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at logger (/usr/src/app/node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m         at Layer.handle [as handle_request] (/usr/src/app/node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m         at trim_prefix (/usr/src/app/node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m         at /usr/src/app/node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m         at Function.process_params (/usr/src/app/node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m         at next (/usr/src/app/node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m         at /usr/src/app/node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m         at AsyncResource.runInAsyncScope (node:async_hooks:203:9)
[32mtests_1    |[0m         at invokeCallback (/usr/src/app/node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m         at done (/usr/src/app/node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m         at IncomingMessage.onEnd (/usr/src/app/node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m         at IncomingMessage.emit (node:events:525:35)
[32mtests_1    |[0m         at endReadableNT (node:internal/streams/readable:1358:12)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:83:21) {
[32mtests_1    |[0m       status: 400
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       62 |     return res.json({ item });
[32mtests_1    |[0m       63 |   } catch (err) {
[32mtests_1    |[0m     > 64 |     console.error("PATCH /items/:id error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       65 |     return next(err);
[32mtests_1    |[0m       66 |   }
[32mtests_1    |[0m       67 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:64:13)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/route.js:144:13)
[32mtests_1    |[0m       at Route.dispatch (node_modules/express/lib/router/route.js:114:3)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:284:15
[32mtests_1    |[0m       at param (node_modules/express/lib/router/index.js:365:14)
[32mtests_1    |[0m       at param (node_modules/express/lib/router/index.js:376:14)
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:421:3)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at Function.handle (node_modules/express/lib/router/index.js:175:3)
[32mtests_1    |[0m       at router (node_modules/express/lib/router/index.js:47:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at next (middleware/auth.js:15:12)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at logger (node_modules/morgan/index.js:144:5)
[32mtests_1    |[0m       at Layer.handle [as handle_request] (node_modules/express/lib/router/layer.js:95:5)
[32mtests_1    |[0m       at trim_prefix (node_modules/express/lib/router/index.js:328:13)
[32mtests_1    |[0m       at node_modules/express/lib/router/index.js:286:9
[32mtests_1    |[0m       at Function.process_params (node_modules/express/lib/router/index.js:346:12)
[32mtests_1    |[0m       at next (node_modules/express/lib/router/index.js:280:10)
[32mtests_1    |[0m       at node_modules/body-parser/lib/read.js:137:5
[32mtests_1    |[0m       at invokeCallback (node_modules/raw-body/index.js:231:16)
[32mtests_1    |[0m       at done (node_modules/raw-body/index.js:220:7)
[32mtests_1    |[0m       at IncomingMessage.onEnd (node_modules/raw-body/index.js:280:7)
[32mtests_1    |[0m 
[32mtests_1    |[0m PATCH /items/1 400 79 - 5.895 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PATCH /items/:id hit with id: 0 body: { description: 'Updated description' }
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:53:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     PATCH /items/:id error: NotFoundError: No item: 0
[32mtests_1    |[0m         at Object.<anonymous> (/usr/src/app/tests/routes/itemRoutes.test.js:185:37)
[32mtests_1    |[0m         at Promise.then.completed (/usr/src/app/node_modules/jest-circus/build/utils.js:298:28)
[32mtests_1    |[0m         at new Promise (<anonymous>)
[32mtests_1    |[0m         at callAsyncCircusFn (/usr/src/app/node_modules/jest-circus/build/utils.js:231:10)
[32mtests_1    |[0m         at _callCircusTest (/usr/src/app/node_modules/jest-circus/build/run.js:316:40)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:96:5)
[32mtests_1    |[0m         at _runTest (/usr/src/app/node_modules/jest-circus/build/run.js:252:3)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:126:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at run (/usr/src/app/node_modules/jest-circus/build/run.js:71:3)
[32mtests_1    |[0m         at runAndTransformResultsToJestFormat (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
[32mtests_1    |[0m         at jestAdapter (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
[32mtests_1    |[0m         at runTestInternal (/usr/src/app/node_modules/jest-runner/build/runTest.js:367:16)
[32mtests_1    |[0m         at runTest (/usr/src/app/node_modules/jest-runner/build/runTest.js:444:34) {
[32mtests_1    |[0m       status: 404
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       62 |     return res.json({ item });
[32mtests_1    |[0m       63 |   } catch (err) {
[32mtests_1    |[0m     > 64 |     console.error("PATCH /items/:id error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       65 |     return next(err);
[32mtests_1    |[0m       66 |   }
[32mtests_1    |[0m       67 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:64:13)
[32mtests_1    |[0m 
[32mtests_1    |[0m PATCH /items/0 404 47 - 3.324 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     DELETE /items/:id hit with id: 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:70:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m DELETE /items/1 200 13 - 2.631 ms
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     DELETE /items/:id hit with id: 0
[32mtests_1    |[0m 
[32mtests_1    |[0m       at log (routes/items.js:70:11)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.error
[32mtests_1    |[0m     DELETE /items/:id error: NotFoundError: No item: 0
[32mtests_1    |[0m         at Object.<anonymous> (/usr/src/app/tests/routes/itemRoutes.test.js:208:37)
[32mtests_1    |[0m         at Promise.then.completed (/usr/src/app/node_modules/jest-circus/build/utils.js:298:28)
[32mtests_1    |[0m         at new Promise (<anonymous>)
[32mtests_1    |[0m         at callAsyncCircusFn (/usr/src/app/node_modules/jest-circus/build/utils.js:231:10)
[32mtests_1    |[0m         at _callCircusTest (/usr/src/app/node_modules/jest-circus/build/run.js:316:40)
[32mtests_1    |[0m         at processTicksAndRejections (node:internal/process/task_queues:96:5)
[32mtests_1    |[0m         at _runTest (/usr/src/app/node_modules/jest-circus/build/run.js:252:3)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:126:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at _runTestsForDescribeBlock (/usr/src/app/node_modules/jest-circus/build/run.js:121:9)
[32mtests_1    |[0m         at run (/usr/src/app/node_modules/jest-circus/build/run.js:71:3)
[32mtests_1    |[0m         at runAndTransformResultsToJestFormat (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
[32mtests_1    |[0m         at jestAdapter (/usr/src/app/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
[32mtests_1    |[0m         at runTestInternal (/usr/src/app/node_modules/jest-runner/build/runTest.js:367:16)
[32mtests_1    |[0m         at runTest (/usr/src/app/node_modules/jest-runner/build/runTest.js:444:34) {
[32mtests_1    |[0m       status: 404
[32mtests_1    |[0m     }
[32mtests_1    |[0m 
[32mtests_1    |[0m       73 |     return res.json({ deleted: +req.params.id });
[32mtests_1    |[0m       74 |   } catch (err) {
[32mtests_1    |[0m     > 75 |     console.error("DELETE /items/:id error:", err); // Add error logging
[32mtests_1    |[0m          |             ^
[32mtests_1    |[0m       76 |     return next(err);
[32mtests_1    |[0m       77 |   }
[32mtests_1    |[0m       78 | });
[32mtests_1    |[0m 
[32mtests_1    |[0m       at error (routes/items.js:75:13)
[32mtests_1    |[0m 
[32mtests_1    |[0m DELETE /items/0 404 47 - 3.767 ms
[32mtests_1    |[0m PASS tests/routes/itemRoutes.test.js
[32mtests_1    |[0m   Item Routes Test
[32mtests_1    |[0m     POST /items
[32mtests_1    |[0m       âœ“ works: creates a new item (25 ms)
[32mtests_1    |[0m       âœ“ bad request with missing data (48 ms)
[32mtests_1    |[0m       âœ“ bad request with invalid data type (21 ms)
[32mtests_1    |[0m     GET /items
[32mtests_1    |[0m       âœ“ works: gets all items (10 ms)
[32mtests_1    |[0m       âœ“ works: filtering with query (13 ms)
[32mtests_1    |[0m     GET /items/:id
[32mtests_1    |[0m       âœ“ works: gets item by id (9 ms)
[32mtests_1    |[0m       âœ“ not found for non-existent item (18 ms)
[32mtests_1    |[0m     PATCH /items/:id
[32mtests_1    |[0m       âœ“ works: updates item (11 ms)
[32mtests_1    |[0m       âœ“ bad request with invalid data (14 ms)
[32mtests_1    |[0m       âœ“ not found for non-existent item (12 ms)
[32mtests_1    |[0m     DELETE /items/:id
[32mtests_1    |[0m       âœ“ works: deletes item (9 ms)
[32mtests_1    |[0m       âœ“ not found for non-existent item (11 ms)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/models/user.test.js
[32mtests_1    |[0m   User Model Tests
[32mtests_1    |[0m     authenticate
[32mtests_1    |[0m       âœ• works with valid credentials (1 ms)
[32mtests_1    |[0m       âœ• fails with wrong password (1 ms)
[32mtests_1    |[0m       âœ• fails with non-existent user (1 ms)
[32mtests_1    |[0m     register
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• fails with duplicate username (1 ms)
[32mtests_1    |[0m     findAll
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m     get
[32mtests_1    |[0m       âœ• works (1 ms)
[32mtests_1    |[0m       âœ• not found if no such user (1 ms)
[32mtests_1    |[0m     update
[32mtests_1    |[0m       âœ• works
[32mtests_1    |[0m     remove
[32mtests_1    |[0m       âœ• works
[32mtests_1    |[0m       âœ• not found if no such user
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º authenticate â€º works with valid credentials
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º authenticate â€º fails with wrong password
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º authenticate â€º fails with non-existent user
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º register â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º register â€º fails with duplicate username
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º findAll â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º get â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º get â€º not found if no such user
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º update â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º remove â€º works
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— User Model Tests â€º remove â€º not found if no such user
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m       11 | describe("User Model Tests", () => {
[32mtests_1    |[0m       12 |   beforeEach(async () => {
[32mtests_1    |[0m     > 13 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       14 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       15 |     
[32mtests_1    |[0m       16 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/user.test.js:13:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/routes/authRoutes.test.js
[32mtests_1    |[0m   Auth Routes Test
[32mtests_1    |[0m     POST /auth/token
[32mtests_1    |[0m       âœ• works: can login with valid credentials (1 ms)
[32mtests_1    |[0m       âœ• unauth with non-existent user (1 ms)
[32mtests_1    |[0m       âœ• unauth with wrong password (1 ms)
[32mtests_1    |[0m       âœ• bad request with missing data
[32mtests_1    |[0m       âœ• bad request with invalid data
[32mtests_1    |[0m     POST /auth/register
[32mtests_1    |[0m       âœ• works: can register
[32mtests_1    |[0m       âœ• bad request with duplicate username
[32mtests_1    |[0m       âœ• bad request with invalid email (4 ms)
[32mtests_1    |[0m       âœ• bad request with missing fields
[32mtests_1    |[0m       âœ• bad request with invalid data types (1 ms)
[32mtests_1    |[0m       âœ• cannot set admin to true (1 ms)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/token â€º works: can login with valid credentials
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/token â€º unauth with non-existent user
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/token â€º unauth with wrong password
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/token â€º bad request with missing data
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/token â€º bad request with invalid data
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º works: can register
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º bad request with duplicate username
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º bad request with invalid email
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º bad request with missing fields
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º bad request with invalid data types
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Auth Routes Test â€º POST /auth/register â€º cannot set admin to true
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        7 | describe("Auth Routes Test", () => {
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m     >  9 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       10 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m       11 |     
[32mtests_1    |[0m       12 |     await User.register({
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/routes/authRoutes.test.js:9:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m FAIL tests/models/item.test.js
[32mtests_1    |[0m   Item Model Tests
[32mtests_1    |[0m     âœ• can create an item (1 ms)
[32mtests_1    |[0m     âœ• can find all items
[32mtests_1    |[0m     âœ• can get item by id (1 ms)
[32mtests_1    |[0m     âœ• can find items by box (1 ms)
[32mtests_1    |[0m     âœ• can update item (1 ms)
[32mtests_1    |[0m     âœ• not found if no such item (1 ms)
[32mtests_1    |[0m     âœ• can delete item
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can create an item
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can find all items
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can get item by id
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can find items by box
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can update item
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º not found if no such item
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   â— Item Model Tests â€º can delete item
[32mtests_1    |[0m 
[32mtests_1    |[0m     TypeError: Cannot read properties of undefined (reading 'query')
[32mtests_1    |[0m 
[32mtests_1    |[0m        8 |   beforeEach(async () => {
[32mtests_1    |[0m        9 |     // Clean tables in correct order
[32mtests_1    |[0m     > 10 |     await db.query("DELETE FROM items");
[32mtests_1    |[0m          |              ^
[32mtests_1    |[0m       11 |     await db.query("DELETE FROM boxes");
[32mtests_1    |[0m       12 |     await db.query("DELETE FROM moves");
[32mtests_1    |[0m       13 |     await db.query("DELETE FROM users");
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.query (tests/models/item.test.js:10:14)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     QRBoxer Config:
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:22:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     SECRET_KEY: secret-dev
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:23:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     PORT: 3001
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:24:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     BCRYPT_WORK_FACTOR 1
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:25:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     Database: postgresql://test_user:test_password@test-db:5432/test_db
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:26:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m   console.log
[32mtests_1    |[0m     ---
[32mtests_1    |[0m 
[32mtests_1    |[0m       at Object.log (config/config.js:27:9)
[32mtests_1    |[0m 
[32mtests_1    |[0m POST /moves 201 128 - 2.573 ms
[32mtests_1    |[0m POST /moves 400 164 - 2.969 ms
[32mtests_1    |[0m PASS tests/routes/moveRoutes.test.js
[32mtests_1    |[0m   Move Routes Test
[32mtests_1    |[0m     POST /moves
[32mtests_1    |[0m       âœ“ works: creates a new move (19 ms)
[32mtests_1    |[0m       âœ“ bad request with missing data (16 ms)
[32mtests_1    |[0m 
[32mtests_1    |[0m Test Suites: 6 failed, 3 passed, 9 total
[32mtests_1    |[0m Tests:       59 failed, 27 passed, 86 total
[32mtests_1    |[0m Snapshots:   0 total
[32mtests_1    |[0m Time:        3.147 s
[32mtests_1    |[0m Ran all test suites.
[32mtests_1    |[0m npm notice 
[32mtests_1    |[0m npm notice New major version of npm available! 8.19.4 -> 11.1.0
[32mtests_1    |[0m npm notice Changelog: <https://github.com/npm/cli/releases/tag/v11.1.0>
[32mtests_1    |[0m npm notice Run `npm install -g npm@11.1.0` to update!
[32mtests_1    |[0m npm notice 
[32mqrboxer-backend_tests_1 exited with code 1
[0m